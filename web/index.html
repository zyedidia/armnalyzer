<!DOCTYPE html>
<html>
<body>

<canvas id="canvas" width="4096" height="4096" style="image-rendering: pixelated;"></canvas>

<script type='text/javascript' src='./js/panzoom.min.js'></script>
<script type='text/javascript' src='./js/decode.js'></script>
<script type='text/javascript' src='./js/arm64.js'></script>

<script>
var c = document.getElementById("canvas");
var ctx = c.getContext("2d");
drawing = new Image();
drawing.src = "arm64.png";
drawing.onload = function() {
    ctx.drawImage(drawing, 0, 0, 4096, 4096);
};
c.onclick = ev => {
    const coord = getMousePos(c, ev);
    mouseClick(coord.x, coord.y);
};

const zoom = Panzoom(c, {
  maxScale: 200,
  cursor: ''
});
c.addEventListener('wheel', zoom.zoomWithWheel);

function xyToHilbert(x, y, order) {
    let s = 0;
    for (let i = order - 1; i >= 0; i--) {
        const xi = (x >> i) & 1;
        const yi = (y >> i) & 1;
        if (yi == 0) {
            const tmp = x;
            x = y ^ (-xi);
            y = tmp ^ (-xi);
        }
        s = 4 * s + 2 * xi + (xi ^ yi);
    }
    return s;
}

function mouseClick(x, y) {
    let s = xyToHilbert(x, y, 12)
    let insn_start = s * 256;
    for (var insn = insn_start; insn < insn_start + 256; insn++) {
        for (var i = 0; i < funcs.length; i++) {
            if (funcs[i](insn)) {
                console.log(insn, arm64_json[i]);
                break;
            }
        }
    }
}

function getMousePos(canvas, ev) {
    const rect = canvas.getBoundingClientRect();
    return {
        x: (((ev.clientX - rect.left) / (rect.right - rect.left)) * canvas.width) | 0,
        y: (((ev.clientY - rect.top) / (rect.bottom - rect.top)) * canvas.height) | 0
    };
}
</script>

</body>
</html>
